# Test info

- Name: Automatic route testing >> mobile view >> auto-visual test of routes on mobile
- Location: /Users/freedommarketing/Desktop/effort-flow-planner/tests/ui.spec.ts:292:13

# Error details

```
Error: expect(page).toHaveScreenshot(expected)

  25049 pixels (ratio 0.11 of all image pixels) are different.

Expected: /Users/freedommarketing/Desktop/effort-flow-planner/tests/ui.spec.ts-snapshots/mobile-home-page-chromium-darwin.png
Received: /Users/freedommarketing/Desktop/effort-flow-planner/screenshots/ui-Automatic-route-testing-28364-al-test-of-routes-on-mobile-chromium/mobile-home-page-actual.png
    Diff: /Users/freedommarketing/Desktop/effort-flow-planner/screenshots/ui-Automatic-route-testing-28364-al-test-of-routes-on-mobile-chromium/mobile-home-page-diff.png

Call log:
  - expect.toHaveScreenshot(mobile-home-page.png) with timeout 10000ms
    - verifying given screenshot expectation
  - taking page screenshot
    - disabled all CSS animations
  - waiting for fonts to load...
  - fonts loaded
  - 25049 pixels (ratio 0.11 of all image pixels) are different.
  - waiting 100ms before taking screenshot
  - taking page screenshot
    - disabled all CSS animations
  - waiting for fonts to load...
  - fonts loaded
  - captured a stable screenshot
  - 25049 pixels (ratio 0.11 of all image pixels) are different.

    at /Users/freedommarketing/Desktop/effort-flow-planner/tests/ui.spec.ts:331:40
```

# Page snapshot

```yaml
- region "Notifications (F8)":
  - list
- region "Notifications alt+T"
- img "DoNext Logo"
- button "Switch to dark mode":
  - img
- img "Flame icon"
- text: "0"
- button "Menu":
  - img
  - text: Menu
- heading "Suggestions for Next Steps" [level=2]
- paragraph: Future home of intelligent task suggestions. For now, consider what's most important or time-sensitive!
- button "Owed to Others (Due Today or Past Due)" [expanded]:
  - text: Owed to Others (Due Today or Past Due)
  - img
- paragraph: No tasks owed to others are due today or past due.
- button "All My Tasks":
  - text: All My Tasks
  - img
- button "Add Quick Task":
  - img
```

# Test source

```ts
  231 |             // Take full page screenshot that will include the sidebar
  232 |             await expect(page).toHaveScreenshot('desktop-with-sidebar.png');
  233 |         });
  234 |
  235 |         test('desktop dashboard content', async ({ page }) => {
  236 |             await page.goto('/');
  237 |             await waitForPageStability(page);
  238 |
  239 |             // Screenshot main content area - avoiding precise element selection
  240 |             // Just give the app enough time to fully render
  241 |             await expect(page).toHaveScreenshot(
  242 |                 'desktop-dashboard-content.png'
  243 |             );
  244 |         });
  245 |     });
  246 |
  247 |     // Mobile view tests
  248 |     test.describe('Mobile viewport', () => {
  249 |         test.use({ viewport: devices.mobile });
  250 |
  251 |         test('mobile layout (sidebar likely collapsed)', async ({ page }) => {
  252 |             await page.goto('/');
  253 |             await waitForPageStability(page);
  254 |
  255 |             // On mobile, sidebar may be collapsed by default - this is expected
  256 |             await expect(page).toHaveScreenshot('mobile-default-view.png');
  257 |
  258 |             // Try to find and click a hamburger menu or sidebar toggle if it exists
  259 |             const possibleToggles = [
  260 |                 page.getByRole('button', {
  261 |                     name: /menu|toggle|hamburger|sidebar/i,
  262 |                 }),
  263 |                 page.locator(
  264 |                     '.hamburger, [data-testid="menu-button"], button.menu-toggle'
  265 |                 ),
  266 |                 page.locator('button').filter({ hasText: /☰|≡|menu/i }),
  267 |             ];
  268 |
  269 |             // Try each possible toggle selector
  270 |             for (const toggle of possibleToggles) {
  271 |                 if ((await toggle.count()) > 0 && (await toggle.isVisible())) {
  272 |                     await toggle.click();
  273 |                     await page.waitForTimeout(1000); // Wait for animation
  274 |                     await expect(page).toHaveScreenshot(
  275 |                         'mobile-with-sidebar-open.png'
  276 |                     );
  277 |                     break; // Stop after first successful toggle
  278 |                 }
  279 |             }
  280 |         });
  281 |     });
  282 | });
  283 |
  284 | // This is a utility to help generate visual tests for all routes
  285 | test.describe('Automatic route testing', () => {
  286 |     // Run on both desktop and mobile
  287 |     for (const [deviceName, viewport] of Object.entries(devices)) {
  288 |         test.describe(`${deviceName} view`, () => {
  289 |             // Set viewport for this test group
  290 |             test.use({ viewport });
  291 |
  292 |             test(`auto-visual test of routes on ${deviceName}`, async ({
  293 |                 page,
  294 |             }) => {
  295 |                 // List of routes to test
  296 |                 const routes = ['/', '/tasks', '/notes', '/login'];
  297 |                 let authenticated = false;
  298 |
  299 |                 // Start with login route to handle authentication first
  300 |                 const sortedRoutes = [
  301 |                     '/login',
  302 |                     ...routes.filter((r) => r !== '/login'),
  303 |                 ];
  304 |
  305 |                 for (const route of sortedRoutes) {
  306 |                     // Get a simple name for the route for the screenshot file
  307 |                     const pageName =
  308 |                         route === '/' ? 'home' : route.substring(1);
  309 |
  310 |                     // Handle authentication only once if needed
  311 |                     if (route !== '/login' && !authenticated) {
  312 |                         await authenticate(page);
  313 |                         authenticated = true;
  314 |                     }
  315 |
  316 |                     // Navigate to the route
  317 |                     await page.goto(route);
  318 |                     await waitForPageStability(page);
  319 |
  320 |                     // Check if we got redirected to login page (authentication required)
  321 |                     if (route !== '/login' && page.url().includes('/login')) {
  322 |                         console.log(
  323 |                             `Redirected to login - authentication required for ${route}`
  324 |                         );
  325 |                         await authenticate(page);
  326 |                         await page.goto(route);
  327 |                         await waitForPageStability(page);
  328 |                     }
  329 |
  330 |                     // Take screenshot with device prefix to distinguish between views
> 331 |                     await expect(page).toHaveScreenshot(
      |                                        ^ Error: expect(page).toHaveScreenshot(expected)
  332 |                         `${deviceName}-${pageName}-page.png`
  333 |                     );
  334 |                 }
  335 |             });
  336 |         });
  337 |     }
  338 | });
  339 |
```